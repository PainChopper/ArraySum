# ArraySum - Сравнение стратегий суммирования файлов

Проект демонстрирует различные подходы к суммированию чисел из бинарного файла с фокусом на производительность.

## Реализованные стратегии

### 1. Наивная стратегия (SimpleBufferReader)
- Последовательное чтение элементов по одному
- Простота реализации, низкая производительность

### 2. Стратегия с буфером на стеке (ThreadPoolStackBuffer)
- Многопоточное чтение с использованием ThreadPool
- Буферизация с использованием Span<byte>

### 3. Стратегия с ArrayPool и асинхронными операциями (ThreadPoolArrayPoolBufferAsyncWorker)
- Использование ArrayPool для снижения нагрузки на GC
- Асинхронное чтение файла

### 4. Стратегия с ArrayPool и синхронными операциями (ThreadPoolArrayPoolBufferSyncWorker)
- Использование ArrayPool для управления памятью
- Синхронное чтение файла

## Как использовать

Проект содержит абстрактный класс `SortStrategy`, реализуемый всеми стратегиями:
```csharp
Task<long> Run(CancellationToken token = default)
```

## Результаты производительности

| Стратегия | Результат суммы | Время выполнения (мс) |
|-----------|----------------|-----------------------|
| Наивная стратегия | 500490436924 | ~30000 |
| Стратегия c буфером на стеке | 500490436924 | 1099,59 |
| Стратегия c буфером в ArrayPool и асинхронными workerами | 500490436924 | 1102,96 |
| Стратегия c буфером в ArrayPool и синхронными workerами | 500490436924 | 968,11 |

- **Синхронные операции** обычно быстрее и стабильнее для параллельных задач, если работа уже разделена между потоками через ThreadPool.
- **Асинхронность** оправдана, когда есть реальное ожидание медленных внешних ресурсов (например, сеть или HDD). Для быстрых операций и многопоточной обработки может дать лишь избыточные накладные расходы.
- **Stream.Read(Span<byte>)** внутри .NET сначала читает данные во внутренний буфер (ArrayPool), а затем копирует их в предоставленный Span. Поэтому использование stackalloc для буфера не дает прироста.

## Требования

- .NET 7.0 или выше
