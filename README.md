# ArraySum - Эффективные стратегии суммирования больших файлов

Этот проект демонстрирует различные подходы к чтению и суммированию большого количества чисел из бинарного файла. Особое внимание уделено производительности и эффективному использованию системных ресурсов.

## Задача

Реализовать различные алгоритмы для подсчета суммы целых чисел (int32), хранящихся в большом бинарном файле (более 1 миллиарда элементов). Каждый алгоритм должен корректно обрабатывать весь файл и возвращать правильную сумму.

## Реализованные стратегии

### 1. Наивная стратегия (SimpleBufferReader)
- Последовательное чтение элементов из файла по одному
- Простота реализации, но низкая производительность
- Не использует дополнительные потоки или буферизацию

### 2. Стратегия с буфером на стеке (ThreadPoolStackBuffer)
- Многопоточное чтение с использованием ThreadPool
- Эффективная буферизация с использованием стекового размещения буфера (Span<byte>)
- Разделение файла на сегменты для параллельной обработки
- Существенное увеличение производительности

### 3. Стратегия с буфером из ArrayPool и асинхронными операциями (ThreadPoolArrayPoolBufferAsyncWorker)
- Использование ArrayPool для снижения нагрузки на GC
- Асинхронное чтение файла
- Применение современных API (Memory<T>)
- Многопоточная обработка данных

### 4. Стратегия с буфером из ArrayPool и синхронными операциями (ThreadPoolArrayPoolBufferSyncWorker)
- Использование ArrayPool для управления памятью
- Синхронное чтение файла
- Эффективное использование Span<T> для zero-allocation обработки данных
- Многопоточная обработка данных

## Как использовать

Проект содержит общий интерфейс `ISortStrategy`, который реализуется всеми стратегиями суммирования. Каждая стратегия предоставляет метод:
```csharp
Task<long> Run(CancellationToken token = default)
```

Для добавления новой стратегии необходимо:
1. Создать новый класс в директории SumStrategies 
2. Реализовать интерфейс ISortStrategy
3. Добавить стратегию в список в Program.cs

## Производительность

При тестировании на файле с 1 миллиардом целых чисел наблюдались следующие результаты:

| Стратегия | Результат суммы | Время выполнения (мс) |
|-----------|----------------|-----------------------|
| Наивная стратегия | 500490436924 | ~30000 |
| Стратегия c буфером на стеке | 500490436924 | 1099,59 |
| Стратегия c буфером в ArrayPool и асинхронными workerами | 500490436924 | 1102,96 |
| Стратегия c буфером в ArrayPool и синхронными workerами | 500490436924 | 968,11 |

## Выводы по производительности

1. Все многопоточные стратегии показывают значительный прирост производительности по сравнению с наивной реализацией
2. Синхронная версия с использованием ArrayPool показала наилучшие результаты
3. Асинхронные операции имеют небольшие накладные расходы по сравнению с синхронными для данного сценария
4. Различие между использованием стека и ArrayPool незначительно для одиночных запусков

## Особенности реализации

При реализации многопоточных стратегий следует обратить внимание на:
- Правильное распределение диапазонов чтения (без пересечений и пропусков)
- Эффективное использование буферизации
- Корректную обработку границ чтения для избежания дублирования данных
- Контроль за суммарным количеством обработанных элементов

## Технические требования

- .NET 7.0 или выше
- Достаточное количество доступной памяти для обработки файла
